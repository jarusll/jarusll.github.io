<!doctype html><html lang=en-us><head><title>Mirroring my github repos to bitbucket | Suraj Yadav</title><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="Mirroring my github repos to bitbucket üîóUpdate: üîóYou might wanna take a look at git ... --mirror
On 13th of April, 2022 I was stuck with a ref lock thing with my portfolio repo. It was really dirty one and the only way I solved it was importing the repo to bitbucket & reimporting it back. Made me think about backups.
Fortunately, I was tinkering with Ansible1. It was a good learning opporunity, mirror my repos using Ansible and I did it."><meta name=generator content="Hugo 0.99.1"><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/images/favicon.ico type=image/x-icon></head><body><nav class=navigation><a href=/><span class=arrow>‚Üê</span>Home</a>
<a href=/fragments>fragments</a>
<a href=/diary>diary</a></nav><main class=main><section id=single><h1 class=title>Mirroring my github repos to bitbucket</h1><div class=tip><time datetime="2022-04-15 00:00:00 +0000 UTC">Apr 15, 2022</time>
<span class=split>¬∑</span>
<span>212 words</span>
<span class=split>¬∑</span>
<span>1 minute read</span></div><div class=content><h1 id=mirroring-my-github-repos-to-bitbucket>Mirroring my github repos to bitbucket <a href=#mirroring-my-github-repos-to-bitbucket class=anchor>üîó</a></h1><h2 id=update>Update: <a href=#update class=anchor>üîó</a></h2><p>You might wanna take a look at <code>git ... --mirror</code></p><p>On 13th of April, 2022 I was stuck with a ref lock thing with my portfolio repo. It was really dirty one and the only way I solved it was importing the repo to bitbucket & reimporting it back. Made me think about backups.</p><p>Fortunately, I was tinkering with Ansible<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. It was a good learning opporunity, mirror my repos using Ansible and I did it.</p><p>Pretty sure this isn&rsquo;t the best way to achieve this but it works.</p><p>Here&rsquo;s the code, Its cronified for every hour on my vps.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Mirror github to bitbucket</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># hosts: gcp</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>connection</span>: <span style=color:#ae81ff>local</span>
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#f92672>vars</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>git_username</span>: <span style=color:#e6db74>&#34;jarusll&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>git_dir</span>: <span style=color:#e6db74>&#34;~/source/ansible_clones&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>prefix</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>github</span>: <span style=color:#e6db74>&#34;git@github.com&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bitbucket</span>: <span style=color:#e6db74>&#34;git@bitbucket.org&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>remote</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>github</span>: <span style=color:#e6db74>&#34;origin&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>bitbucket</span>: <span style=color:#e6db74>&#34;bit&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repos</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>jarusll.github.io</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>diary</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>posts</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>fragments</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>artworks</span>
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>dotfiles</span>
</span></span><span style=display:flex><span>      
</span></span><span style=display:flex><span>  <span style=color:#f92672>tasks</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Clone all repos from github</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ansible.builtin.git</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>repo</span>: <span style=color:#e6db74>&#34;{{prefix.github}}:{{git_username}}/{{item}}.git&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>clone</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>dest</span>: <span style=color:#e6db74>&#34;{{git_dir}}/{{item}}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>update</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>register</span>: <span style=color:#ae81ff>repo</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>loop</span>: <span style=color:#e6db74>&#34;{{repos}}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Add bitbucket remotes to all repos</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ansible.builtin.shell</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>cmd</span>: <span style=color:#e6db74>&#34;git remote add {{remote.bitbucket}} {{prefix.bitbucket}}:{{git_username}}/{{item}}.git&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>chdir</span>: <span style=color:#e6db74>&#34;{{git_dir}}/{{item}}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>loop</span>: <span style=color:#e6db74>&#34;{{repos}}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ignore_errors</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Push to bitbucket</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ansible.builtin.shell</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>cmd</span>: <span style=color:#e6db74>&#34;git push bit&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>chdir</span>: <span style=color:#e6db74>&#34;{{git_dir}}/{{item}}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>loop</span>: <span style=color:#e6db74>&#34;{{repos}}&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>ignore_errors</span>: <span style=color:#66d9ef>yes</span>
</span></span></code></pre></div><p>Check out my <a href=https://github.com/jarusll/ansible-playground target=_blank rel=noopener>Ansible playground repo</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.ansible.com target=_blank rel=noopener>https://www.ansible.com</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=tags><a href=https://surajyadav.xyz/tags/solution>solution</a></div></section></main><footer id=footer><div class=copyright>¬© Copyright
2022
<span class=split><svg fill="#bbb" width="15" height="15" id="heart-15" xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 15 15"><path d="M13.91 6.75c-1.17 2.25-4.3 5.31-6.07 6.94-.1903.1718-.4797.1718-.67.0C5.39 12.06 2.26 9 1.09 6.75-1.48 1.8 5-1.5 7.5 3.45 10-1.5 16.48 1.8 13.91 6.75z"/></svg></span></div></footer></body></html>